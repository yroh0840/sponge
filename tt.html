<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ã‚¸ãƒ£ãƒ³ãƒ—æ¤œå‡ºãƒ†ã‚¹ãƒˆ</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    #count { font-size: 32px; margin: 20px; }
    #status { font-size: 24px; margin: 10px; color: #333; }
    button { padding: 10px 20px; font-size: 18px; }
  </style>
</head>
<body>
  <h1>ã‚¸ãƒ£ãƒ³ãƒ—æ¤œå‡ºãƒ†ã‚¹ãƒˆ</h1>
  <div id="count">ã‚¸ãƒ£ãƒ³ãƒ—å›žæ•°: 0</div>
  <div id="status">å¾…æ©Ÿä¸­...</div>
  <button id="startBtn">é–‹å§‹</button>

  <script>
    let jumpCount = 0;
    let jumping = false;
    let running = false;

    const countDisplay = document.getElementById("count");
    const statusDisplay = document.getElementById("status");
    const startBtn = document.getElementById("startBtn");

    function handleJump(z) {
      if (!running) return;

      if (!jumping && Math.abs(z) < 2) {
        // å®™ã«æµ®ã„ãŸï¼
        jumping = true;
        statusDisplay.textContent = "ã‚¸ãƒ£ãƒ³ãƒ—ä¸­ï¼ðŸ•´ï¸";
      }

      if (jumping && Math.abs(z) > 15) {
        // ç€åœ°ï¼
        jumpCount++;
        countDisplay.textContent = `ã‚¸ãƒ£ãƒ³ãƒ—å›žæ•°: ${jumpCount}`;
        statusDisplay.textContent = "ç€åœ° âœ…";
        jumping = false;
      }
    }

    startBtn.addEventListener("click", () => {
      running = true;
      jumpCount = 0;
      jumping = false;
      countDisplay.textContent = "ã‚¸ãƒ£ãƒ³ãƒ—å›žæ•°: 0";
      statusDisplay.textContent = "æ¤œå‡ºé–‹å§‹ï¼ç«¯æœ«ã‚’æŒã£ã¦ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¦ã­";

      if (typeof DeviceMotionEvent.requestPermission === "function") {
        // iOSç”¨ã®è¨±å¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        DeviceMotionEvent.requestPermission().then(response => {
          if (response === "granted") {
            window.addEventListener("devicemotion", (e) => {
              const z = e.accelerationIncludingGravity.z;
              handleJump(z);
            });
          } else {
            statusDisplay.textContent = "ã‚»ãƒ³ã‚µãƒ¼åˆ©ç”¨ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ";
          }
        });
      } else {
        // Androidã‚„PCç”¨
        window.addEventListener("devicemotion", (e) => {
          const z = e.accelerationIncludingGravity.z;
          handleJump(z);
        });
      }
    });
  </script>
</body>
</html>
