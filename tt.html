<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ジャンプ検出テスト（シンプル版）</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    button { padding: 10px 20px; font-size: 18px; }
    p { font-size: 20px; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>ジャンプ検出テスト（シンプル版）</h1>
  <button id="startBtn">開始</button>
  <p>結果はブラウザのコンソールに表示されます</p>

  <script>
    let jumping = false;
    let jumpCount = 0;

    function startDetection() {
      if (typeof DeviceMotionEvent.requestPermission === "function") {
        // iOSの場合は許可をリクエスト
        DeviceMotionEvent.requestPermission().then(response => {
          if (response === "granted") {
            window.addEventListener("devicemotion", handleMotion);
            console.log("ジャンプ検出開始！");
          } else {
            console.log("センサー利用が拒否されました");
          }
        });
      } else {
        // Androidなどはそのまま使える
        window.addEventListener("devicemotion", handleMotion);
        console.log("ジャンプ検出開始！");
      }
    }

    function handleMotion(e) {
      const z = e.accelerationIncludingGravity.z;

      if (!jumping && Math.abs(z) < 2) {
        // 宙に浮いた！
        jumping = true;
        console.log("ジャンプ中！🕴️");
      }

      if (jumping && Math.abs(z) > 15) {
        // 着地した！
        jumpCount++;
        console.log("ジャンプ回数:", jumpCount);
        jumping = false;
      }
    }

    document.getElementById("startBtn").addEventListener("click", startDetection);
  </script>
</body>
</html>
